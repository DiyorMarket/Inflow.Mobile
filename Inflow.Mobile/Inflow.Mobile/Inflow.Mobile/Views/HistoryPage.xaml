<!--  HistoryPage.xaml  -->
<ContentPage
    x:Class="Inflow.Mobile.Views.HistoryPage"
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:md="clr-namespace:Plugin.MaterialDesignControls.Material3;assembly=Plugin.MaterialDesignControls"
    xmlns:viewModels="clr-namespace:Inflow.Mobile.ViewModels">

    <ContentPage.Content>
        <StackLayout Margin="5">
            <!--  SaleHistory uchun CollectionView  -->
            <CollectionView
                x:Name="HistoryList"
                ItemsSource="{Binding SaleHistory}"
                SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout>
                            <!--  Itemlarning shakli  -->
                            <Grid Margin="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!--  SaleId  -->
                                <Label
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    TextColor="Black"
                                    FontSize="Medium"
                                    Text="SaleId: " />
                                <Label
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    TextColor="Black"
                                    FontSize="Subtitle"
                                    HorizontalOptions="End"
                                    Text="{Binding Id}" />

                                <!--  SaleDate  -->
                                <Label
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    TextColor="Black"
                                    FontSize="Medium"
                                    Text="SaleDate: " />
                                <Label
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    TextColor="Black"
                                    FontSize="Subtitle"
                                    HorizontalOptions="End"
                                    Text="{Binding SaleDate, StringFormat='{0:dd/MM/yyyy}'}" />

                                <!--  Quantity  -->
                                <Label
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    TextColor="Black"
                                    FontSize="Medium"
                                    Text="Quantity: " />
                                <Label
                                    Grid.Row="2"
                                    Grid.Column="1"
                                   TextColor="Black"
                                    FontSize="Subtitle"
                                    HorizontalOptions="End"
                                    Text="{Binding Quantity}" />

                                <!--  TotalDue  -->
                                <Label
                                    Grid.Row="3"
                                    Grid.Column="0"
                                    TextColor="Black"
                                    FontSize="Medium"
                                    Text="TotalDue: " />
                                <Label
                                    Grid.Row="3"
                                    Grid.Column="1"
                                    TextColor="Black"
                                    FontSize="Medium"
                                    HorizontalOptions="End"
                                    Text="{Binding TotalDue, StringFormat='${0:N2}'}" />

                                <!--  Show Products button  -->

                            </Grid>
                            <!--  Show Products button  -->
                            <md:MaterialButton
                                Margin="10,5,0,10"
                                BackgroundColor="#00A3FF"
                                Command="{Binding BindingContext.ShowProductsCommand, Source={x:Reference Name=HistoryList}}"
                                CommandParameter="{Binding .}"
                                Text="Show Products"
                                TextColor="White" />

                            <!--  SaleItems  -->
                            <CollectionView
                                Margin="10"
                                IsVisible="{Binding SalesVisible}"
                                ItemsSource="{Binding SaleItems}"
                                SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <StackLayout Margin="10" Orientation="Horizontal">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Image Aspect="Fill" Source="{Binding Product.ImageUrl}" HeightRequest="80" WidthRequest="90" Grid.Column="0"/>
                                                <StackLayout Margin="10,5,0,0" Grid.Column="1">
                                                    <Label Text="{Binding Product.Name}" TextColor="Black" FontSize="Medium"/>
                                                    <Label Text="{Binding Quantity, StringFormat='Quantity: {0}'}" TextColor="Black"/>
                                                    <Label Text="{Binding TotalDue, StringFormat='Unit Price: {0:C}'}" TextColor="Black" Grid.Column="2"/>
                                                </StackLayout>
                                            </Grid>
                                        </StackLayout>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>
